# Architecture - Credit Card Management & AI Helper System

## Table of Contents

- [Architecture - Credit Card Management & AI Helper System](#table-of-contents)
  - [Executive Summary](./executive-summary.md)
  - [Decision Summary](./decision-summary.md)
  - [Architecture Decision Records (ADRs)](./architecture-decision-records-adrs.md)
    - [ADR-001: Installment Data Model + Statement-Aware Budget Periods](./architecture-decision-records-adrs.md#adr-001-installment-data-model-statement-aware-budget-periods)
      - [1. Two-Table Installment Storage](./architecture-decision-records-adrs.md#1-two-table-installment-storage)
      - [2. Payment Methods Extended for Credit Cards](./architecture-decision-records-adrs.md#2-payment-methods-extended-for-credit-cards)
      - [3. Budget Period Rules](./architecture-decision-records-adrs.md#3-budget-period-rules)
      - [4. Budget Calculation Queries](./architecture-decision-records-adrs.md#4-budget-calculation-queries)
    - [ADR-002: Feature Flag Infrastructure (PostHog)](./architecture-decision-records-adrs.md#adr-002-feature-flag-infrastructure-posthog)
    - [ADR-003: Helper System Architecture (Class-Based + LLM Routing)](./architecture-decision-records-adrs.md#adr-003-helper-system-architecture-class-based-llm-routing)
    - [ADR-004: Credit Mode Switch Behavior (Non-Destructive)](./architecture-decision-records-adrs.md#adr-004-credit-mode-switch-behavior-non-destructive)
    - [ADR-005: Scheduled Jobs Infrastructure (In-Process Scheduler)](./architecture-decision-records-adrs.md#adr-005-scheduled-jobs-infrastructure-in-process-scheduler)
    - [ADR-006: Statement Period Calculation (Edge Case Handling)](./architecture-decision-records-adrs.md#adr-006-statement-period-calculation-edge-case-handling)
    - [ADR-007: Budget Calculation Performance (Real-Time Aggregation)](./architecture-decision-records-adrs.md#adr-007-budget-calculation-performance-real-time-aggregation)
    - [ADR-008: Helper Rollout & Testing Strategy (Manual + Metrics-Driven)](./architecture-decision-records-adrs.md#adr-008-helper-rollout-testing-strategy-manual-metrics-driven)
    - [ADR-009: AI Cost Management for Helpers (Per-Helper Domain Tracking)](./architecture-decision-records-adrs.md#adr-009-ai-cost-management-for-helpers-per-helper-domain-tracking)
      - [1. Extend Existing  Table](./architecture-decision-records-adrs.md#1-extend-existing-table)
      - [2. Cost Enforcement Function](./architecture-decision-records-adrs.md#2-cost-enforcement-function)
      - [3. Graceful Degradation in BaseHelper](./architecture-decision-records-adrs.md#3-graceful-degradation-in-basehelper)
      - [4. Admin Cost Analytics](./architecture-decision-records-adrs.md#4-admin-cost-analytics)
    - [ADR-010: Auto-Payment Category Design (Saved Category)](./architecture-decision-records-adrs.md#adr-010-auto-payment-category-design-saved-category)
    - [ADR-011: Performance Optimization Strategy (Defer Until Proven Need)](./architecture-decision-records-adrs.md#adr-011-performance-optimization-strategy-defer-until-proven-need)
      - [1. Index Strategy (Sufficient for Expected Load)](./architecture-decision-records-adrs.md#1-index-strategy-sufficient-for-expected-load)
      - [2. Performance Monitoring](./architecture-decision-records-adrs.md#2-performance-monitoring)
      - [3. Query Optimization Guidelines](./architecture-decision-records-adrs.md#3-query-optimization-guidelines)
      - [4. Optimization Decision Tree](./architecture-decision-records-adrs.md#4-optimization-decision-tree)
    - [ADR-012: Analytics Event Design (Extend Existing PostHog Pattern)](./architecture-decision-records-adrs.md#adr-012-analytics-event-design-extend-existing-posthog-pattern)
      - [1. Frontend Events (Extend Existing Pattern)](./architecture-decision-records-adrs.md#1-frontend-events-extend-existing-pattern)
      - [2. WhatsApp Bot Events (New Integration)](./architecture-decision-records-adrs.md#2-whatsapp-bot-events-new-integration)
      - [3. Usage Examples](./architecture-decision-records-adrs.md#3-usage-examples)
      - [4. PostHog Dashboards](./architecture-decision-records-adrs.md#4-posthog-dashboards)
  - [Implementation Roadmap](./implementation-roadmap.md)
    - [Phase 1: Foundation (Week 1-2)](./implementation-roadmap.md#phase-1-foundation-week-1-2)
    - [Phase 2: Credit Card Management (Week 3-5)](./implementation-roadmap.md#phase-2-credit-card-management-week-3-5)
    - [Phase 3: AI Helper System (Week 6-8)](./implementation-roadmap.md#phase-3-ai-helper-system-week-6-8)
    - [Phase 4: Iteration & Expansion (Week 9+)](./implementation-roadmap.md#phase-4-iteration-expansion-week-9)
  - [Database Migration Summary](./database-migration-summary.md)
    - [New Tables](./database-migration-summary.md#new-tables)
    - [Table Modifications](./database-migration-summary.md#table-modifications)
    - [Views](./database-migration-summary.md#views)
  - [Technology Stack Summary](./technology-stack-summary.md)
    - [Existing (Unchanged)](./technology-stack-summary.md#existing-unchanged)
    - [New Additions](./technology-stack-summary.md#new-additions)
  - [Risk Assessment & Mitigation](./risk-assessment-mitigation.md)
    - [High Risk](./risk-assessment-mitigation.md#high-risk)
    - [Medium Risk](./risk-assessment-mitigation.md#medium-risk)
    - [Low Risk](./risk-assessment-mitigation.md#low-risk)
  - [Success Metrics (Post-Launch)](./success-metrics-post-launch.md)
    - [Credit Card Management (Epic A)](./success-metrics-post-launch.md#credit-card-management-epic-a)
    - [AI Helper System (Epic B)](./success-metrics-post-launch.md#ai-helper-system-epic-b)
    - [Performance (NFRs)](./success-metrics-post-launch.md#performance-nfrs)
  - [Next Steps](./next-steps.md)
    - [Immediate (Before Implementation)](./next-steps.md#immediate-before-implementation)
    - [Development Phase](./next-steps.md#development-phase)
    - [Post-Launch](./next-steps.md#post-launch)
  - [Appendix A: Functional Requirements Coverage](./appendix-a-functional-requirements-coverage.md)
  - [Appendix B: File Structure Changes](./appendix-b-file-structure-changes.md)
    - [New Files](./appendix-b-file-structure-changes.md#new-files)
    - [Modified Files](./appendix-b-file-structure-changes.md#modified-files)
    - [Database Migrations](./appendix-b-file-structure-changes.md#database-migrations)
