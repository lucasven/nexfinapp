{"id":"lv-expense-tracker-5td","title":"On cards listing, credit card pay day is showing the numbers of days after closing for payment","description":"**Current behavior:** The credit card listing shows the raw payment_due_day value (e.g., '10 days') instead of the actual calculated payment date.\n\n**Expected behavior:** Should display the actual payment due date (e.g., '15') based on the statement closing date + payment_due_day calculation.\n\n**Location:** Payment methods / cards listing page","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T10:11:55.13314-03:00","created_by":"lucasventurella","updated_at":"2026-01-08T23:42:53.634191-03:00","closed_at":"2026-01-08T23:42:53.634191-03:00","close_reason":"Fixed: Due date now shows calculated date (e.g., '26 jan 2026') instead of just the day offset number (e.g., 'Dia 10')","dependencies":[{"issue_id":"lv-expense-tracker-5td","depends_on_id":"lv-expense-tracker-aj4","type":"parent-child","created_at":"2026-01-08T17:34:46.431972-03:00","created_by":"lucasventurella"}]}
{"id":"lv-expense-tracker-7zq","title":"Future installment being calculated as part of the current month spends in the dashboard","description":"**Current behavior:** Future installment payments are being included in the current month's spending calculations on the dashboard, making budget totals inaccurate.\n\n**Expected behavior:** Only installment payments within the current statement period should be included in spending calculations. Future installments should not affect current month totals.\n\n**Impact:** Budget dashboard shows inflated spending, leading to incorrect financial awareness.\n\n**Location:** Dashboard spending calculation / budget progress widgets\n\n**Related:** Discovered while investigating installment deletion bug (lv-expense-tracker-9ar)","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-07T10:22:49.246312-03:00","created_by":"lucasventurella","updated_at":"2026-01-08T21:40:10.337904-03:00","closed_at":"2026-01-08T21:40:10.337904-03:00","close_reason":"Fixed month overflow bug in calculate_statement_period(). For closing days 26-31, the function now correctly caps to the last day of the month (e.g., Feb 30 -\u003e Feb 28). Migration 049_fix_statement_period_overflow.sql created.","dependencies":[{"issue_id":"lv-expense-tracker-7zq","depends_on_id":"lv-expense-tracker-9ar","type":"discovered-from","created_at":"2026-01-07T10:32:58.401062-03:00","created_by":"lucasventurella"},{"issue_id":"lv-expense-tracker-7zq","depends_on_id":"lv-expense-tracker-pqk","type":"parent-child","created_at":"2026-01-08T17:34:45.33408-03:00","created_by":"lucasventurella"}]}
{"id":"lv-expense-tracker-9ar","title":"When a user deletes a credit card installment, child installments are staying in the dashboard","description":"**Current behavior:** When a user deletes a credit card installment (parent transaction), the child installment records remain in the database and continue to appear in the dashboard.\n\n**Expected behavior:** Deleting the parent installment should cascade delete all associated child installment records.\n\n**Impact:** Data integrity issue - orphaned records pollute the dashboard and may affect budget calculations.\n\n**Location:** Installment deletion flow (both frontend and WhatsApp bot)","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-07T10:19:34.781464-03:00","created_by":"lucasventurella","updated_at":"2026-01-08T21:27:57.371832-03:00","closed_at":"2026-01-08T21:27:57.371832-03:00","close_reason":"Fixed client-side caching bug. Added useEffect to clear monthDetails cache when commitments prop changes in FutureCommitmentsMonthList component.","dependencies":[{"issue_id":"lv-expense-tracker-9ar","depends_on_id":"lv-expense-tracker-pqk","type":"parent-child","created_at":"2026-01-08T17:34:45.685492-03:00","created_by":"lucasventurella"}]}
{"id":"lv-expense-tracker-aj4","title":"Fix dashboard display issues","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-08T17:33:58.084038-03:00","created_by":"lucasventurella","updated_at":"2026-01-08T17:33:58.084038-03:00","dependencies":[{"issue_id":"lv-expense-tracker-aj4","depends_on_id":"lv-expense-tracker-wcd","type":"blocks","created_at":"2026-01-09T18:01:12.03087-03:00","created_by":"lucasventurella"}]}
{"id":"lv-expense-tracker-d0n","title":"Stabilize test suite","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-08T17:33:58.632158-03:00","created_by":"lucasventurella","updated_at":"2026-01-08T20:45:44.650238-03:00","closed_at":"2026-01-08T20:45:44.650238-03:00","close_reason":"All children completed"}
{"id":"lv-expense-tracker-e3z","title":"Move payment method to first field in transaction dialog","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-09T20:20:40.452765-03:00","created_by":"lucasventurella","updated_at":"2026-01-09T20:20:40.452765-03:00"}
{"id":"lv-expense-tracker-etj","title":"Integration tests fail without database connection","description":"## Summary\n17 integration tests fail when running `npm test` because they require a live Supabase connection.\n\n## Error\n```\nFailed to create test user: TypeError: fetch failed\n```\n\n## Affected Test Suites\n1. **example.test.ts** (3 failures)\n   - should seed and retrieve engagement state\n   - should count message queue entries\n   - should support complete test infrastructure integration\n\n2. **destination-handler.integration.test.ts** (14 failures)\n   - All tests in 'Individual JID Destination Routing'\n   - All tests in 'Group Destination Routing'\n   - All tests in 'Fallback Scenarios'\n   - All tests in 'Send-Time Resolution'\n   - All tests in 'Destination Switching + Message Queue Integration'\n   - All tests in 'Fallback Chain'\n\n## Root Cause\nIntegration tests call `createTestUser()` in `src/__tests__/utils/test-database.ts:117` which requires a real Supabase connection. When running locally without `SUPABASE_URL` and `SUPABASE_SERVICE_KEY`, fetch fails.\n\n## Options\n1. **Skip integration tests by default** - Add `.skip` or a conditional skip based on env var\n2. **Mock the database layer** - Convert to unit tests with mocked Supabase\n3. **Separate test commands** - `npm test` for unit, `npm run test:integration` for integration\n4. **Document requirement** - Require test env vars to run full suite\n\n## Recommendation\nOption 3: Create `npm run test:unit` and `npm run test:integration` scripts. Default `npm test` should run only unit tests that don't require external dependencies.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-08T17:26:47.445741-03:00","created_by":"lucasventurella","updated_at":"2026-01-08T20:45:28.865132-03:00","closed_at":"2026-01-08T20:45:28.865132-03:00","close_reason":"Fixed: 1) Added example.test.ts and destination-handler.integration.test.ts to jest.config.js testPathIgnorePatterns (17 integration tests now excluded from unit tests). 2) Fixed stale mock data in budgets.test.ts - added is_default field required by dual budget system, fixed mockQuerySequence order (6 tests fixed).","dependencies":[{"issue_id":"lv-expense-tracker-etj","depends_on_id":"lv-expense-tracker-d0n","type":"parent-child","created_at":"2026-01-08T17:34:47.348826-03:00","created_by":"lucasventurella"}]}
{"id":"lv-expense-tracker-pqk","title":"Fix installment calculation bugs","status":"open","priority":0,"issue_type":"epic","created_at":"2026-01-08T17:33:57.711488-03:00","created_by":"lucasventurella","updated_at":"2026-01-08T17:33:57.711488-03:00"}
{"id":"lv-expense-tracker-qv1","title":"Upgrade baileys package to latest v7.0.0","description":"WhatsApp is decommissioning the old way of identifying users. We need to upgrade Baileys to v7.0.0 to support the new Local Identifier (LID) system.\n\n## Migration Guide\nhttps://baileys.wiki/docs/migration/to-v7.0.0\n\n## Key Breaking Changes\n\n### Local Identifier (LID) System\n- WhatsApp replaced phone number-based identification with LIDs (unique user identifiers for privacy)\n- Auth state must support `lid-mapping`, `device-list`, and `tctoken` keys\n- Users can be contacted via LID or phone number (PN)\n- All new Signal sessions are now in LID format\n\n### Contact and Group Metadata Updates\n- Contact interface no longer includes `jid`/`lid` fields\n- New `id` field (WhatsApp's preferred identifier) plus either `phoneNumber` or `lid`\n- Group metadata now has owner/ownerPn, descOwner/descOwnerPn pairs\n\n### Acknowledgment Behavior\n- Baileys no longer sends ACKs on successful message delivery (WhatsApp ban prevention)\n\n## Required Code Changes\n\n### Module System Migration (ESM)\n- Library switched from CommonJS to ESM\n- Options: Convert project to ESM OR use dynamic imports\n\n### API Adjustments\n- Remove `isJidUser()` calls → replace with `isPnUser()`\n- `onWhatsApp()` no longer returns LIDs\n- Access LID/PN mappings via: `sock.signalRepository.lidMapping`\n\n### Protobuf Changes\n- Only `.create()`, `.encode()`, and `.decode()` methods remain\n- Use BufferJSON utilities for encoding\n- Use new `decodeAndHydrate()` method for decoding\n\n## Impact on Our Codebase\n- Multi-identifier system in `utils/user-identifiers.ts` may need updates\n- Auth state handling in `auth-state/` directory\n- Message handlers that use JID/LID identification\n- Group message participant identification","status":"open","priority":0,"issue_type":"chore","created_at":"2026-01-07T17:35:38.755391-03:00","created_by":"lucasventurella","updated_at":"2026-01-07T17:35:38.755391-03:00"}
{"id":"lv-expense-tracker-wcd","title":"next commitments widget in the dashboard is showing credit cards installments from previous date","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-09T17:56:35.096434-03:00","created_by":"lucasventurella","updated_at":"2026-01-09T17:56:35.096434-03:00"}
{"id":"lv-expense-tracker-x3e","title":"Receita recorrente não aparece no dashboard","description":"Quando um usuário adiciona uma receita recorrente, ela deveria aparecer no dashboard no mesmo dia todo mês. Atualmente, a receita não aparece no dashboard no mês seguinte.\n\n**Comportamento esperado:**\n- Receita recorrente deve aparecer automaticamente no dashboard a cada mês\n- Deve manter o mesmo dia configurado (ex: dia 5 de cada mês)\n\n**Comportamento atual:**\n- A receita recorrente não aparece no dashboard após o primeiro mês\n\n**Impacto:**\n- Usuários não conseguem visualizar suas receitas recorrentes corretamente\n- Dashboard mostra informações incompletas sobre o fluxo de caixa","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T09:58:21.310738-03:00","created_by":"lucasventurella","updated_at":"2026-01-08T23:53:37.455023-03:00","closed_at":"2026-01-08T23:53:37.455023-03:00","close_reason":"Fixed: Implemented lazy payment generation. Now recurring payments are automatically created on-demand when fetching for a specific month, ensuring recurring income/expenses always appear on the dashboard regardless of when they were created.","dependencies":[{"issue_id":"lv-expense-tracker-x3e","depends_on_id":"lv-expense-tracker-aj4","type":"parent-child","created_at":"2026-01-08T17:34:46.075602-03:00","created_by":"lucasventurella"}]}
{"id":"lv-expense-tracker-yet","title":"statement-reminder-query.test.ts mock missing .in() method","description":"## Summary\nThe `statement-reminder-query.test.ts` unit tests are failing because the Supabase mock is missing the `.in()` chain method.\n\n## Error\n```\nTypeError: supabase.from(...).select(...).in is not a function\n```\n\n## Location\n- File: `src/__tests__/services/reminders/statement-reminder-query.test.ts`\n- Source: `src/services/reminders/statement-reminder-query.ts:88`\n\n## Failing Tests (4)\n1. should return eligible users with closing day in 3 days\n2. should handle month boundary correctly (Dec 29 → Jan 1)\n3. should filter out users without WhatsApp identifier\n4. should filter out users who opted out of reminders\n\n## Root Cause\nThe mock setup in the test file doesn't include the `.in()` method in the chain. The production code uses:\n```typescript\n.from('authorized_whatsapp_numbers')\n.select('user_id, whatsapp_jid, whatsapp_lid, whatsapp_number, is_primary')\n.in('user_id', userIds)\n```\n\n## Fix\nAdd `.in()` to the mock chain builder, returning the same chainable object.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T17:26:33.381902-03:00","created_by":"lucasventurella","updated_at":"2026-01-08T17:41:40.828451-03:00","closed_at":"2026-01-08T17:41:40.828451-03:00","close_reason":"Fixed by refactoring test to use centralized Supabase mock with mockQuerySequence() which includes .in() support","dependencies":[{"issue_id":"lv-expense-tracker-yet","depends_on_id":"lv-expense-tracker-d0n","type":"parent-child","created_at":"2026-01-08T17:34:47.010598-03:00","created_by":"lucasventurella"}]}
